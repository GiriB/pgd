<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">

<html>
    <head>
        <style type="text/css">@import "jquery.svg.css";</style> 
        <style>
            #canvas {
                width: 470;
                height: 500;
                margin: 10px;
            }

            #controls {
                margin-top:30px;
            }

            #button-plot {
                margin-top:10px;
            }

            #binDetails {
                position:absolute;
                float:left;
                width:auto;
                padding:4px;
                background-color:grey;
                font-size:10;
                color:white;
                border: 1px solid #aaaaaa;
            }
        </style>

        <script type="text/javascript" src="{{MEDIA_URL}}/js/jquery-1.2.6.js"></script>
        <script type="text/javascript" src="{{MEDIA_URL}}/js/jquery.svg.js"></script>

        <script type="text/javascript">
            $(document).ready(function() {
                $('#canvas').svg()

                fix = .5;
                x = 100;
                y = 100;
                height = 400;
                width = 400;
                borderPadding = 40;
                var svg = $('#canvas').svg('get');
                {% for rect in svg.rects %}
                    svg.rect(
                        {{rect.x}}+fix,
                        {{rect.y}}+fix,
                        {{rect.height}},
                        {{rect.width}},
                        {fill: '{{rect.fill}}', stroke: '0', 'stroke-width': {{rect.stroke}}}
                    );
                {% endfor %}

                {% for line in svg.lines %}
                    svg.line(
                        {{line.x}}+fix,
                        {{line.y}}+fix,
                        {{line.x1}}+fix,
                        {{line.y1}}+fix,
                        {stroke: '{{line.color}}', 'stroke-width': {{line.stroke}}}
                    );
                {% endfor %}


                {% for text in svg.texts %}
                    svg.text(
                        {{text.x}},
                        {{text.y}},
                        '{{text.text}}',
                        {'font-family': "{{text.fontfamily}}", 'font-size': "{{text.size}}", fill: "{{text.fill}}"}
                    );
                {% endfor %}

                    /*
                    $('#button-plot').click(function (evt) {
                        with(document.plotform) {
                            data = {
                                'xStart' : xStart.value,
                                'xEnd' : xEnd.value,
                                'yStart' : yStart.value,
                                'yEnd' : yEnd.value,
                                'attribute' : attribute.value,
                                'xProperty' : xProperty.value,
                                'yProperty' : yProperty.value,
                                'residue' : residue.value,
                                'xBin' : xBin.value,
                                'yBin' : yBin.value,
                                'reference' : reference.value
                            }
                        }
                    });*/

                    $('#attribute_select').change(function (){
                         $("#id_attribute option:selected").each(function () {
                            document.plotform.reference.value = REF[$(this).text()]['ref'];
                         });
                    })

                    {% for rect in boxes %}
                        svg.rect(
                            {{rect.0}}+fix,
                            {{rect.1}}+fix,
                            {{rect.2}},
                            {{rect.3}},
                            {fill: '#{{rect.4}}', stroke: '#{{rect.4}}', 'stroke-width': 1, onmouseover:'bin_mouseover(evt, {{rect.6}});', onmouseout:'bin_mouseout();'}
                        );
                    {% endfor %}


                    });

                var REF = {};
                {% for k,v in referenceValues.items %}
                    {% ifnotequal k 'Observations' %}
                        REF['{{k}}'] = {'ref':{{v.ref}},'stepsize':{{v.stepsize}}}
                    {% endifnotequal %}
                {% endfor %}

                function bin_mouseover(evt, val){
                    $('div#binDetails').html(val).css({left:evt.clientX + 20, top:evt.clientY - 20}).show()
                }

                function bin_mouseout(){
                    $('div#binDetails').hide();
                }
        </script>
    </head>
    <body>
        <div id="canvas"></div>
        <form name="plot" method="POST" action="/search/plot/svg/">
        <div id="controls">
            <div id="attribute">Plotted Attribute 
                {{form.attribute}}
             </div>
             <div>X Axis
                {{form.xProperty}}
            </div>
            <div>Y Axis
                {{form.yProperty}}
            </div>
            <div id="reference">Reference Value {{form.reference}}</div>
            <div id="x">X Min, Max {{form.x}}{{form.x1}}</div>
            <div id="y">Y Min, Max {{form.y}}{{form.y1}}</div>
            <div id="residue">Residue {{form.residue}}</div>

            <div id="bin">Bin X, Y {{form.xBin}}{{form.yBin}}</div>
            <button id="button-plot">Plot</button>
        </div>
        </form>
        <div id="binDetails"></div>
        
        
    </body>
</html>